# üöÄ Automated Deployment Guide

## Quick Start (3 Commands)

```bash
# 1. Setup environment
chmod +x scripts/*.sh
./scripts/deploy-setup.sh

# 2. Generate Vercel env file
node scripts/generate-vercel-env.js

# 3. Deploy (choose one method below)
```

## Method 1: Vercel Dashboard (Recommended for First Time)

### Step 1: Run Setup Script
```bash
./scripts/deploy-setup.sh
```

This will:
- ‚úÖ Create `.env.local` template
- ‚úÖ Generate secure `CRON_SECRET`
- ‚úÖ Prepare all configuration

### Step 2: Update .env.local
Edit `.env.local` and add your actual values:
- OpenAI API key (if using AI features)
- SMTP credentials (if using email)
- Razorpay keys (if using payments)

### Step 3: Generate Vercel Environment File
```bash
node scripts/generate-vercel-env.js
```

This creates:
- `vercel-env.txt` - For Vercel CLI
- `vercel-env.md` - For Vercel Dashboard (copy-paste format)

### Step 4: Deploy via Vercel Dashboard

1. **Go to**: https://vercel.com/new
2. **Import**: `watermelonadsmannuthy-ai/rinads-platform`
3. **Add Environment Variables**:
   - Open `vercel-env.md`
   - Copy each variable to Vercel Dashboard
   - Or manually add from `.env.local`
4. **Deploy**: Click "Deploy"

### Step 5: Post-Deployment

After deployment:
1. Get your Vercel URL: `https://your-project.vercel.app`
2. Update `NEXT_PUBLIC_APP_URL` in Vercel Dashboard
3. Verify cron jobs in Settings ‚Üí Cron Jobs

## Method 2: Vercel CLI (Automated)

### Prerequisites
```bash
npm i -g vercel
```

### Deploy
```bash
# Make script executable
chmod +x scripts/vercel-deploy.sh

# Run deployment script
./scripts/vercel-deploy.sh
```

The script will:
- ‚úÖ Check Vercel CLI installation
- ‚úÖ Login if needed
- ‚úÖ Add environment variables
- ‚úÖ Deploy to production

## Method 3: GitHub Integration (Auto-Deploy)

### Setup Once
1. Go to Vercel Dashboard
2. Import project from GitHub
3. Add environment variables
4. Enable "Auto Deploy"

### Future Deployments
Just push to GitHub:
```bash
git push origin main
```

Vercel will automatically deploy!

## Database Setup (CRITICAL - Do Before Deployment)

### Run in Supabase SQL Editor

Go to: https://supabase.com/dashboard/project/zqeamdmbkvcojriwmoqc/sql/new

Run these in order:

1. **Main Schema**
   ```sql
   -- Copy contents of: supabase/schema.sql
   ```

2. **Support Schema**
   ```sql
   -- Copy contents of: supabase/support-schema.sql
   ```

3. **ERP Agency Schema** ‚ö†Ô∏è **NEW - REQUIRED**
   ```sql
   -- Copy contents of: supabase/erp-agency-schema.sql
   ```

## Environment Variables Checklist

### Required (Must Have)
- [ ] `NEXT_PUBLIC_SUPABASE_URL`
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `CRON_SECRET` (generated by setup script)
- [ ] `NEXT_PUBLIC_APP_URL` (add after deployment)

### Recommended
- [ ] `OPENAI_API_KEY` (for AI features)
- [ ] `OPENAI_MODEL` (default: gpt-4-turbo-preview)

### Optional
- [ ] `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS` (for email)
- [ ] `RAZORPAY_KEY_ID`, `RAZORPAY_KEY_SECRET` (for payments)

## Verification Checklist

After deployment:

- [ ] Build completed successfully
- [ ] App loads at production URL
- [ ] Demo page works: `/demo`
- [ ] Services page works: `/services`
- [ ] Admin dashboard loads: `/admin`
- [ ] Cron jobs visible in Vercel Dashboard
- [ ] Environment variables all set
- [ ] Database schemas run successfully

## Troubleshooting

### Build Fails

1. **Check build logs** in Vercel Dashboard
2. **Test locally first**:
   ```bash
   npm run build
   ```
3. **Common issues**:
   - Missing environment variables
   - TypeScript errors
   - Missing dependencies

### Cron Jobs Not Appearing

1. **Check `vercel.json`** is in root directory
2. **Verify in Vercel Dashboard** ‚Üí Settings ‚Üí Cron Jobs
3. **Wait a few minutes** - cron jobs may take time to appear
4. **Check Vercel plan** - Cron jobs require Pro plan or higher

### Environment Variables Not Working

1. **Redeploy** after adding variables
2. **Check variable names** match exactly
3. **Verify no extra spaces** in values
4. **Check production vs preview** environment

## Post-Deployment Tasks

### 1. Update App URL
After first deployment, update:
```
NEXT_PUBLIC_APP_URL=https://your-actual-url.vercel.app
```

### 2. Configure Razorpay Webhook
1. Go to Razorpay Dashboard
2. Add webhook: `https://your-app.vercel.app/api/razorpay/webhook`
3. Select events: `payment.authorized`, `subscription.activated`
4. Copy webhook secret to Vercel env vars

### 3. Run Seed Script (Optional)
To populate initial data:
```bash
# Locally
npm run seed

# Or create API endpoint for one-time seed
```

### 4. Set Up Monitoring
- [ ] Vercel Analytics (built-in)
- [ ] Sentry for error tracking (optional)
- [ ] Uptime monitoring (optional)

## Quick Reference

### Files Created
- `scripts/deploy-setup.sh` - Initial setup
- `scripts/generate-vercel-env.js` - Generate env files
- `scripts/vercel-deploy.sh` - Automated deployment
- `vercel-env.txt` - Vercel CLI format
- `vercel-env.md` - Dashboard format

### Key URLs
- **Vercel**: https://vercel.com/new
- **Supabase SQL**: https://supabase.com/dashboard/project/zqeamdmbkvcojriwmoqc/sql/new
- **GitHub Repo**: https://github.com/watermelonadsmannuthy-ai/rinads-platform

## Support

If you encounter issues:
1. Check build logs in Vercel
2. Verify all environment variables
3. Check Supabase logs
4. Review error messages
5. Test locally first: `npm run build`

---

**Ready to deploy!** üöÄ

Run `./scripts/deploy-setup.sh` to get started.

